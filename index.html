<!DOCTYPE html>
<html>

<head>
  <script language="JavaScript" type="text/JavaScript"></script>
	<link rel="stylesheet" type="text/css" href="sheet.css" />
</head>

<body>
  <h1 id="p1"></h1>
  <p id="p2"></p>
  <p id="p3"></p>
  <p id="p4"></p>	
    <form action="" name="form1">
      <label for="Radio1" id="Label1"></label>
      <input type="radio" id="Radio1" name="Option" value="Option1" />
      <label for="Radio2" id="Label2"></label>
      <input type="radio" id="Radio2" name="Option" value="Option2" />
    </form>
    <span><input type="button" name="Next" value="Submit" onclick="nextQuestion()" />
					<input type="button" name="Last" value="Previous" onclick="lastQuestion()" />
					<input type="button" name="Account" value="Register/Login" onclick="registerUser()" /></span>
    <script>
		
        var xmlHttp = new XMLHttpRequest();
				var url = "questions.json";
				var allQuestions;
				var p = document.getElementById("p1");
				var choices = new Array();
				var currentIndex = 0;
				var score = 0;
				
    if(xmlHttp){
        xmlHttp.onreadystatechange = function(){
            p4 = document.getElementById("p4");
            if(xmlHttp.readyState == 1) {
                p4.innerHTML = "Status 1: Server connection established! <br/>";
                }
            else if (xmlHttp.readyState == 2) {
                p4.innerHTML = "Status 2: Request recieved! <br/>";
                }
            else if (xmlHttp.readyState == 3) {
                p4.innerHTML = "Status 3: Processing Request!<br/>";
                }
            else if (xmlHttp.readyState == 4) {

                if(xmlHttp.status == 200) {
                    var text = xmlHttp.responseText;
                    p4.innerHTML = "Status 4: Request Complete!<br/>";
                    allQuestions = JSON.parse(text);
										

										p.innerHTML = allQuestions[0].question[0];
			
										document.getElementById("Label1").textContent = allQuestions[0].choices[0];
										document.getElementById("Label2").textContent = allQuestions[0].choices[1];
                    }
                else {
                    alert("Something is wrong!");
                    }
                }
            };
					xmlHttp.open("GET", "questions.json", true);
					xmlHttp.send();
        }
			
      function checkAnswer() {
        for (i = 0; i < form1.length; i++) {
          if (form1[i].checked == true) {
            var checked1 = form1[i];

            if (i == allQuestions[currentIndex].correctAnswer) {
              return true;
            } 
						else {
              return false;
            }
          }
        }
        return false;
      }
			
      function nextQuestion() {
          if (checkAnswer()) {
            alert("Correct!");
            score++;
          } 
					else {
						alert("Incorrect!");
          }
				
				for (i = 0; i <= form1.length; i++) {
					if (i == form1.length) {
						alert("You must answer the question!");
						return;
					}				
					if (form1[i].checked == true) {
						choices[currentIndex] = i;
						break;
					}
				}

        if (allQuestions[currentIndex + 1]) {
          currentIndex++;
          properCheckbox();

          p.innerHTML = allQuestions[currentIndex].question;
          document.getElementById("Label1").textContent = allQuestions[currentIndex].choices[0];
          document.getElementById("Label2").textContent = allQuestions[currentIndex].choices[1];
        } 
				else {
          document.write("Final score: " + score);
        }
      }

      function lastQuestion() {
        currentIndex--;
				
				if (choices[currentIndex] == allQuestions[currentIndex].correctAnswer) {
					score--;
				}
				
        p.innerHTML = allQuestions[currentIndex].question;
        document.getElementById("Label1").textContent = allQuestions[currentIndex].choices[0];
        document.getElementById("Label2").textContent = allQuestions[currentIndex].choices[1];

        properCheckbox();
      }

      function properCheckbox() {
        if (choices[currentIndex] != null) {
          if (choices[currentIndex] == 0) {
            document.getElementById("Radio1").checked = true;
          } else {
            document.getElementById("Radio2").checked = true;
          }
        } 
				else {
          document.getElementById("Radio1").checked = false;
          document.getElementById("Radio2").checked = false;
        }
      }

      function registerUser() {
        if (localStorage && (!localStorage.getItem("username"))) {

          var uname = prompt("Enter username:");
          var pword = prompt("Enter password:");

          localStorage.setItem("username", uname);
          localStorage.setItem("password", pword);
        }

        var display = document.getElementById("p2");
        display.innerHTML = "Hello, " + localStorage.getItem("username");

      }

      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') c = c.substring(1);
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          } 
					else {
            return "";
          }
        }
      }

      function cookieSetter() {
        var expireDate = new Date();
        var expireMonth = expireDate.getMonth();
        expireDate.setMonth(expireMonth + 6);
        var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        document.cookie = "VisitMonth=" + monthNames[expireMonth] + ";expires=" + expireDate.toGMTString() + ";";
        var welcome = document.getElementById("p3");
        welcome.innerHTML = "You last visited this page in " + getCookie("VisitMonth") + ".";
      }

      function xmlRequester(url) {

      }

      function populate() {
        xmlRequester("questions.json");			
        cookieSetter();

      }
    </script>
</body>
</html>